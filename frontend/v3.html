<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saint-Esprit Radio - Newsroom v3</title>

    <!-- Cognito Auth -->
    <script>
        const cognitoConfig = {
            domain: 'saint-esprit-radio-auth.auth.eu-west-3.amazoncognito.com',
            clientId: '5jst6bnhl26ekdr5a7pu9ik2f5',
            redirectUri: window.location.origin + window.location.pathname,
            logoutUri: window.location.origin + '/logout.html',
            region: 'eu-west-3'
        };

        window.cognitoLogout = function() {
            ['saint-esprit-authenticated', 'saint-esprit-auth-code', 'saint-esprit-user',
             'cognito_id_token', 'cognito_access_token', 'cognito_refresh_token'].forEach(
                key => localStorage.removeItem(key)
            );
            window.location.href = `https://${cognitoConfig.domain}/logout?client_id=${cognitoConfig.clientId}&logout_uri=${encodeURIComponent(cognitoConfig.logoutUri)}`;
        }
    </script>

    <!-- CSS Ultra-clean -->
    <link rel="stylesheet" href="v3-1762443141.css">
</head>
<body>

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="logo-saint-esprit-clair-icon-hd.png" alt="Saint-Esprit" class="logo">
            <h1>Saint-Esprit</h1>
        </div>

        <nav class="nav">
            <button class="nav-btn active" data-view="dashboard">
                <span class="icon">üè†</span>
                <span>Dashboard</span>
            </button>
            <button class="nav-btn" data-view="news">
                <span class="icon">üì∞</span>
                <span>News</span>
            </button>
            <button class="nav-btn" data-view="blocks">
                <span class="icon">üìã</span>
                <span>Journaux</span>
            </button>
            <button class="nav-btn" data-view="animation">
                <span class="icon">üéôÔ∏è</span>
                <span>Animation</span>
            </button>
            <button class="nav-btn" data-view="conductor">
                <span class="icon">üì∫</span>
                <span>Conducteur</span>
            </button>
            <button class="nav-btn" data-view="onair">
                <span class="icon">üî¥</span>
                <span>ON AIR</span>
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info" id="user-info">
                <span class="user-avatar">üë§</span>
                <span class="user-name" id="user-name">Chargement...</span>
            </div>
            <button class="logout-btn" onclick="cognitoLogout()">üö™ D√©connexion</button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main">

        <!-- DASHBOARD VIEW -->
        <div class="view active" id="dashboard-view">
            <header class="view-header">
                <h2>Bienvenue, <span id="welcome-name">Clara</span></h2>
                <div class="date" id="current-date"></div>
            </header>

            <div class="cards-grid">
                <div class="card" onclick="app.switchView('news')">
                    <div class="card-icon">üì∞</div>
                    <h3>News</h3>
                    <p>G√©rer les actualit√©s</p>
                    <div class="card-stat" id="news-count">0 aujourd'hui</div>
                </div>

                <div class="card" onclick="app.switchView('blocks')">
                    <div class="card-icon">üìã</div>
                    <h3>Journaux</h3>
                    <p>Cr√©er les journaux</p>
                </div>

                <div class="card" onclick="app.switchView('animation')">
                    <div class="card-icon">üéôÔ∏è</div>
                    <h3>Animation</h3>
                    <p>√âl√©ments d'animation</p>
                </div>

                <div class="card" onclick="app.switchView('conductor')">
                    <div class="card-icon">üì∫</div>
                    <h3>Conducteur</h3>
                    <p>Organiser l'√©mission</p>
                </div>

                <div class="card card-onair" onclick="app.switchView('onair')">
                    <div class="card-icon">üî¥</div>
                    <h3>ON AIR</h3>
                    <p>Diffusion en direct</p>
                </div>
            </div>
        </div>

        <!-- NEWS VIEW -->
        <div class="view" id="news-view">
            <header class="view-header">
                <h2>üì∞ News</h2>
                <button class="btn btn-primary" onclick="createNews()">+ Nouvelle News</button>
            </header>

            <div class="split-view">
                <!-- Liste des news -->
                <div class="list-panel">
                    <input type="search" class="search-input" placeholder="Rechercher une news..." id="news-search">
                    <div class="list" id="news-list">
                        <div class="empty-state">
                            <div class="empty-icon">üì∞</div>
                            <p>Aucune news</p>
                            <button class="btn btn-secondary" onclick="createNews()">Cr√©er une news</button>
                        </div>
                    </div>
                </div>

                <!-- √âditeur de news -->
                <div class="editor-panel" id="news-editor">
                    <div class="editor-placeholder">
                        <div class="placeholder-icon">üìù</div>
                        <p>S√©lectionnez ou cr√©ez une news</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOCKS VIEW (JOURNAUX) -->
        <div class="view" id="blocks-view">
            <header class="view-header">
                <h2>üìã Journaux</h2>
                <button class="btn btn-primary" onclick="app.createJournal()">+ Nouveau Journal</button>
            </header>

            <div class="split-view">
                <!-- Liste des journaux -->
                <div class="list-panel">
                    <input type="search" class="search-input" placeholder="Rechercher un journal..." id="journal-search">
                    <div class="list" id="journal-list">
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <p>Aucun journal</p>
                            <button class="btn btn-secondary" onclick="app.createJournal()">Cr√©er un journal</button>
                        </div>
                    </div>
                </div>

                <!-- Vue du journal -->
                <div class="editor-panel" id="journal-editor">
                    <div class="editor-placeholder">
                        <div class="placeholder-icon">üìã</div>
                        <p>S√©lectionnez ou cr√©ez un journal</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ANIMATION VIEW -->
        <div class="view" id="animation-view">
            <header class="view-header">
                <h2>üéôÔ∏è Animation</h2>
                <button class="btn btn-primary" onclick="app.createAnimation()">+ Nouvelle Animation</button>
            </header>

            <div class="split-view">
                <!-- Liste des animations -->
                <div class="list-panel">
                    <input type="search" class="search-input" placeholder="Rechercher une animation..." onkeyup="app.filterAnimations(this.value)">
                    <div class="list" id="animations-list">
                        <div class="empty-state">
                            <div class="empty-icon">üéôÔ∏è</div>
                            <p>Aucune animation</p>
                            <button class="btn btn-secondary" onclick="app.createAnimation()">Cr√©er une animation</button>
                        </div>
                    </div>
                </div>

                <!-- √âditeur d'animation -->
                <div class="editor-panel" id="animations-editor">
                    <div class="editor-placeholder">
                        <div class="placeholder-icon">üìù</div>
                        <p>S√©lectionnez ou cr√©ez une animation</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONDUCTOR VIEW -->
        <div class="view" id="conductor-view">
            <header class="view-header">
                <h2>üì∫ Conducteur</h2>
                <button class="btn btn-primary" onclick="app.createConductor()">+ Nouveau Conducteur</button>
            </header>

            <div class="split-view">
                <!-- Liste des conducteurs -->
                <div class="list-panel">
                    <input type="search" class="search-input" placeholder="Rechercher un conducteur..." id="conductor-search">
                    <div class="list" id="conductor-list">
                        <div class="empty-state">
                            <div class="empty-icon">üì∫</div>
                            <p>Aucun conducteur</p>
                            <button class="btn btn-secondary" onclick="app.createConductor()">Cr√©er un conducteur</button>
                        </div>
                    </div>
                </div>

                <!-- Vue du conducteur -->
                <div class="editor-panel" id="conductor-editor">
                    <div class="editor-placeholder">
                        <div class="placeholder-icon">üì∫</div>
                        <p>S√©lectionnez ou cr√©ez un conducteur</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ON AIR VIEW -->
        <div class="view" id="onair-view">
            <!-- Top Bar -->
            <div class="onair-topbar">
                <div class="onair-topbar-logo">
                    <div class="onair-logo-icon">üî¥</div>
                    <span>Saint-Esprit</span>
                </div>

                <div class="onair-topbar-status">
                    <div class="onair-live-badge">
                        <span class="onair-live-dot"></span>
                        <span>ON AIR</span>
                    </div>
                    <div class="onair-topbar-time" id="onair-clock">--:--:--</div>
                </div>

                <button class="btn btn-secondary" onclick="app.exitOnAir()">‚úï Quitter</button>
            </div>

            <!-- Main Content -->
            <div class="onair-container">
                <!-- Main Display Area -->
                <div class="onair-main-display">
                    <!-- Segment en cours -->
                    <div class="onair-current-segment" id="onair-current-segment">
                        <!-- Timer en pleine largeur -->
                        <div class="onair-timer-banner">
                            <div class="onair-timer-label">‚è±Ô∏è TEMPS RESTANT</div>
                            <div class="onair-timer-value" id="onair-timer">00:00</div>
                        </div>

                        <div class="onair-segment-header">
                            <div>
                                <div class="onair-segment-badge" id="onair-segment-badge">üì∞ NEWS EN COURS</div>
                                <div class="onair-segment-number" id="onair-segment-number">#1</div>
                            </div>
                            <div class="onair-segment-title" id="onair-segment-title">Aucun conducteur s√©lectionn√©</div>
                        </div>

                        <!-- Lancement -->
                        <div class="onair-lancement-section" id="onair-lancement-section" style="display: none;">
                            <div class="onair-section-label">üé§ LANCEMENT</div>
                            <div class="onair-lancement-text" id="onair-lancement-text"></div>
                        </div>

                        <!-- Audio player -->
                        <div class="onair-audio-section" id="onair-audio-section" style="display: none;">
                            <div class="onair-section-label">üéµ AUDIO</div>
                            <div class="onair-audio-controls">
                                <button class="onair-audio-btn play" id="onair-audio-play" onclick="app.onAirPlayAudio()">‚ñ∂Ô∏è Lire le son</button>
                                <button class="onair-audio-btn stop" id="onair-audio-stop" onclick="app.onAirStopAudio()" style="display: none;">‚èπÔ∏è Stop</button>
                                <div class="onair-audio-info" id="onair-audio-info"></div>
                            </div>
                        </div>

                        <!-- Pied -->
                        <div class="onair-pied-section" id="onair-pied-section" style="display: none;">
                            <div class="onair-section-label">üìù PIED</div>
                            <div class="onair-pied-text" id="onair-pied-text"></div>
                        </div>

                        <!-- Fallback content for non-news segments -->
                        <div class="onair-segment-content" id="onair-segment-content">
                            S√©lectionnez un conducteur depuis la page Conducteur pour d√©marrer.
                        </div>
                    </div>

                    <!-- Contr√¥les -->
                    <div class="onair-controls">
                        <button class="onair-control-btn secondary" onclick="app.onAirPrevious()" title="Pr√©c√©dent">‚èÆÔ∏è</button>
                        <button class="onair-control-btn secondary" onclick="app.onAirPause()" id="onair-pause-btn" title="Pause">‚è∏Ô∏è</button>
                        <button class="onair-control-btn primary" onclick="app.onAirNext()" title="Suivant">‚è≠Ô∏è</button>
                        <button class="onair-control-btn secondary" onclick="app.onAirStop()" title="Stop">‚èπÔ∏è</button>
                    </div>
                </div>

                <!-- Sidebar Info -->
                <div class="onair-sidebar">
                    <!-- Segments suivants -->
                    <div class="onair-upcoming-segments">
                        <div class="onair-upcoming-title">√Ä venir</div>
                        <div id="onair-upcoming-list">
                            <div class="onair-empty-state">
                                Aucun segment suivant
                            </div>
                        </div>
                    </div>

                    <!-- Info √©mission -->
                    <div class="onair-info-card">
                        <div class="onair-info-title">Infos √©mission</div>
                        <div class="onair-info-stats">
                            <div class="onair-stat-item">
                                <div class="onair-stat-value" id="onair-stat-segments">0/0</div>
                                <div class="onair-stat-label">Segments</div>
                            </div>
                            <div class="onair-stat-item">
                                <div class="onair-stat-value" id="onair-stat-elapsed">00:00</div>
                                <div class="onair-stat-label">√âcoul√©</div>
                            </div>
                            <div class="onair-stat-item">
                                <div class="onair-stat-value" id="onair-stat-remaining">00:00</div>
                                <div class="onair-stat-label">Restant</div>
                            </div>
                            <div class="onair-stat-item">
                                <div class="onair-stat-value" id="onair-stat-end">--:--</div>
                                <div class="onair-stat-label">Fin pr√©vue</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AUDIO EDITOR VIEW -->
        <div class="view" id="audio-editor-view">
            <header class="view-header">
                <div class="view-header-left">
                    <button class="btn btn-secondary" onclick="app.returnToNews()">‚Üê Retour √† la News</button>
                    <h2>üéµ √âditeur Audio</h2>
                </div>
                <div class="view-header-right" style="position: relative;">
                    <button class="btn btn-secondary" onclick="app.audioEditor.exportAudio()">üíæ Exporter</button>
                    <!-- Export Menu -->
                    <div id="audio-export-menu" class="export-menu">
                        <div class="export-menu-item" onclick="app.audioEditor.exportToNews()">
                            <span class="export-menu-icon">üì§</span>
                            <div class="export-menu-text">
                                <div class="export-menu-title">Exporter vers la News</div>
                                <div class="export-menu-desc">Remplace l'audio de la news</div>
                            </div>
                        </div>
                        <div class="export-menu-item" onclick="app.audioEditor.exportAsWAV()">
                            <span class="export-menu-icon">üéµ</span>
                            <div class="export-menu-text">
                                <div class="export-menu-title">Exporter en WAV</div>
                                <div class="export-menu-desc">T√©l√©charger en format WAV</div>
                            </div>
                        </div>
                        <div class="export-menu-item" onclick="app.audioEditor.exportAsMP3()">
                            <span class="export-menu-icon">üé∂</span>
                            <div class="export-menu-text">
                                <div class="export-menu-title">Exporter en MP3</div>
                                <div class="export-menu-desc">T√©l√©charger en format MP3</div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="audio-editor-container">
                <!-- Toolbar -->
                <div class="audio-toolbar">
                    <div class="toolbar-section">
                        <button class="toolbar-btn" id="play-btn" onclick="app.audioEditor.togglePlayback()" title="Lecture/Pause (Espace)">‚ñ∂Ô∏è</button>
                        <button class="toolbar-btn" onclick="app.audioEditor.stop()" title="Stop">‚èπÔ∏è</button>
                    </div>
                    <div class="toolbar-section">
                        <button class="toolbar-btn success" onclick="app.audioEditor.setInPoint()" title="Marquer point IN (I)">‚¨áÔ∏è IN</button>
                        <button class="toolbar-btn danger" onclick="app.audioEditor.setOutPoint()" title="Marquer point OUT (O)">‚¨ÜÔ∏è OUT</button>
                        <button class="toolbar-btn" onclick="app.audioEditor.clearInOut()" title="Effacer IN/OUT">üîÑ</button>
                    </div>
                    <div class="toolbar-section">
                        <button class="toolbar-btn" id="cut-btn" onclick="app.audioEditor.cut()" title="Couper (Ctrl+X)" disabled>‚úÇÔ∏è</button>
                        <button class="toolbar-btn" id="copy-btn" onclick="app.audioEditor.copy()" title="Copier (Ctrl+C)" disabled>üìã</button>
                        <button class="toolbar-btn" id="paste-btn" onclick="app.audioEditor.paste()" title="Coller (Ctrl+V)" disabled>üìå</button>
                        <button class="toolbar-btn danger" id="delete-btn" onclick="app.audioEditor.deleteSelection()" title="Supprimer (Suppr)" disabled>üóëÔ∏è</button>
                    </div>
                    <div class="toolbar-section">
                        <button class="toolbar-btn" onclick="app.audioEditor.normalize()" title="Normaliser">üîä</button>
                        <button class="toolbar-btn" id="fadein-btn" onclick="app.audioEditor.fadeIn()" title="Fade In" disabled>üìà</button>
                        <button class="toolbar-btn" id="fadeout-btn" onclick="app.audioEditor.fadeOut()" title="Fade Out" disabled>üìâ</button>
                    </div>
                    <div class="toolbar-section">
                        <button class="toolbar-btn" id="undo-btn" onclick="app.audioEditor.undo()" title="Annuler (Ctrl+Z)" disabled>‚Ü∂</button>
                        <button class="toolbar-btn" id="redo-btn" onclick="app.audioEditor.redo()" title="Refaire (Ctrl+Y)" disabled>‚Ü∑</button>
                    </div>
                </div>

                <!-- Waveform Display -->
                <div class="waveform-container">
                    <canvas id="waveform-canvas"></canvas>
                </div>

                <!-- Transport Controls -->
                <div class="transport-controls">
                    <div class="time-display">
                        <span id="current-time">00:00.000</span>
                        <span class="separator">/</span>
                        <span id="total-duration">00:00.000</span>
                    </div>
                    <div class="zoom-controls">
                        <button class="btn btn-sm" onclick="app.audioEditor.zoomIn()">üîç+</button>
                        <button class="btn btn-sm" onclick="app.audioEditor.zoomOut()">üîç-</button>
                        <button class="btn btn-sm" onclick="app.audioEditor.zoomFit()">‚¨å Ajuster</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- AWS SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1462.0.min.js"></script>

    <!-- Config (AWS config DOIT √™tre charg√© en premier) -->
    <script src="js/config/aws-config.js?v=1762426265"></script>

    <!-- Core JS (gardons ce qui fonctionne) -->
    <script src="js/core/utils.js?v=3.0.0"></script>
    <script src="js/core/cognito-auth.js?v=1.2"></script>
    <script src="js/core/dynamodb-client.js?v=1762426265"></script>
    <script src="js/core/storage-dynamodb-v2.js?v=1762426265"></script>
    <script src="js/core/audio-storage.js?v=1762426265"></script>
    <script src="js/managers/ContentManager.js?v=1756486244"></script>
    <script src="js/components/NewsDurationManager.js?v=1.0"></script>
    <script src="js/components/AudioEditor.js?v=1762858797"></script>

    <!-- V3 App Logic -->
    <script src="v3-app-1762510653.js"></script>

</body>
</html>
