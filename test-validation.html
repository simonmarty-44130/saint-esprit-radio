<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Validation Saint-Esprit AWS</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .info { color: #0ff; }
        #results { margin: 20px 0; padding: 20px; background: #000; border: 1px solid #0f0; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Test de Validation Saint-Esprit AWS</h1>
    <div id="status">Connexion √† saint-esprit.link...</div>
    <div id="results"></div>
    
    <button onclick="runTests()">Lancer les tests</button>
    <button onclick="window.open('https://saint-esprit.link', '_blank')">Ouvrir Saint-Esprit</button>
    
    <script>
        const results = document.getElementById('results');
        const status = document.getElementById('status');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }
        
        async function runTests() {
            results.innerHTML = '';
            log('üìä D√©but des tests de validation...', 'info');
            
            // Test 1: V√©rifier l'acc√®s √† l'API
            try {
                const response = await fetch('https://saint-esprit.link/index.html');
                if (response.ok) {
                    const html = await response.text();
                    
                    // V√©rifier AWS SDK unique
                    const awsSdkMatches = html.match(/aws-sdk-[\d.]+\.min\.js/g) || [];
                    if (awsSdkMatches.length === 1) {
                        log('‚úÖ AWS SDK: Une seule version trouv√©e (' + awsSdkMatches[0] + ')', 'success');
                    } else if (awsSdkMatches.length > 1) {
                        log('‚ùå AWS SDK: ' + awsSdkMatches.length + ' versions trouv√©es!', 'error');
                        awsSdkMatches.forEach(v => log('  - ' + v, 'warning'));
                    } else {
                        log('‚ö†Ô∏è AWS SDK: Aucune version trouv√©e', 'warning');
                    }
                    
                    // V√©rifier storage-dynamodb
                    if (html.includes('storage-dynamodb.js?v=1757350310')) {
                        log('‚úÖ Storage: storage-dynamodb.js avec nouveau timestamp', 'success');
                    } else if (html.includes('storage-dynamodb.js')) {
                        log('‚ö†Ô∏è Storage: storage-dynamodb.js trouv√© mais pas la nouvelle version', 'warning');
                    } else {
                        log('‚ùå Storage: storage-dynamodb.js non trouv√©', 'error');
                    }
                    
                    // V√©rifier HabillageManager
                    if (html.includes('HabillageManager.js?v=1757350310')) {
                        log('‚úÖ HabillageManager: Pr√©sent avec nouveau timestamp', 'success');
                    } else if (html.includes('HabillageManager.js')) {
                        log('‚ö†Ô∏è HabillageManager: Pr√©sent mais pas la nouvelle version', 'warning');
                    }
                    
                    // V√©rifier UnifiedBroadcast supprim√©
                    if (html.includes('<!-- <script src="js/components/automation/UnifiedBroadcast.js')) {
                        log('‚úÖ UnifiedBroadcast: Correctement comment√©/supprim√©', 'success');
                    } else if (html.includes('UnifiedBroadcast.js') && !html.includes('<!--')) {
                        log('‚ùå UnifiedBroadcast: Toujours actif!', 'error');
                    } else {
                        log('‚úÖ UnifiedBroadcast: Supprim√©', 'success');
                    }
                    
                    // V√©rifier OnAir
                    if (html.includes('OnAir.js?v=1757350310')) {
                        log('‚úÖ OnAir: Module avec nouveau timestamp', 'success');
                    }
                    
                    // V√©rifier app.js
                    if (html.includes('app.js?v=1757350310')) {
                        log('‚úÖ App.js: Nouveau timestamp appliqu√©', 'success');
                    }
                    
                    log('', 'info');
                    log('üìã R√âSUM√â:', 'info');
                    log('Cache CloudFront invalid√© √† ' + new Date().toLocaleTimeString(), 'info');
                    log('Toutes les versions ont √©t√© mises √† jour avec timestamp: 1757350310', 'info');
                    
                } else {
                    log('‚ùå Impossible d\'acc√©der √† saint-esprit.link', 'error');
                }
            } catch (error) {
                log('‚ùå Erreur lors des tests: ' + error.message, 'error');
            }
            
            log('', 'info');
            log('üéØ Tests termin√©s. Ouvrez saint-esprit.link dans un navigateur pour v√©rifier le fonctionnement.', 'info');
        }
        
        // Lancer les tests automatiquement
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>